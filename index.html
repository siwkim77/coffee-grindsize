<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>그라인더 분쇄도 변환기</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 구글 폰트 추가 -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="shortcut.png" /> 
    <style>
        /* 글로벌 스타일 */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        /* CSS 변수으로 색상 관리 */
        :root {
            --primary-color: #4E342E; /* 다크 브라운 */
            --secondary-color: #6D4C41; /* 라이트 브라운 */
            --accent-color: #FFB74D; /* 골든 옐로우 */
            --background-color: #f5f5f5; /* 라이트 그레이 */
            --text-color: #3E2723; /* 진한 브라운 */
            --border-color: #BCAAA4; /* 연한 브라운 */
            --shadow-color: rgba(0, 0, 0, 0.1);
            --success-color: #8BC34A; /* 연두색 */
            --info-color: #FFB74D; /* 골든 옐로우 */
        }

        /* 기본 스타일링 */
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0px;
            background-color: var(--background-color);
            color: var(--text-color);
        }

        h1 {
            text-align: center;
            font-size: 2em;
            margin-bottom: 30px;
            color: var(--primary-color);
        }

        .converter, .add-data {
            background: #fff;
            padding: 25px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px var(--shadow-color);
            margin-bottom: 25px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .field {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--primary-color);
        }

        select, input {
            width: 100%;
            padding: 12px 15px;
            font-size: 1em;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        select:focus, input:focus {
            border-color: var(--accent-color);
            outline: none;
            box-shadow: 0 0 5px var(--accent-color);
        }

        .result {
            margin-top: 25px;
            padding: 15px;
            background: #FFE0B2; /* 라이트 오렌지 */
            border-left: 5px solid var(--accent-color);
            border-radius: 5px;
            font-size: 1.1em;
            text-align: center;
            color: var(--text-color);
        }

        .add-data button {
            width: 100%;
            padding: 12px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            background-color: var(--info-color);
            color: #fff;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-bottom: 0px;
        }

        .add-data button:hover {
            background-color: #FFA726; /* 다소 진한 골든 옐로우 */
        }

        .add-data form {
            display: none;
            margin-top: 20px;
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
        }

        .add-data form.active {
            display: block;
        }

        .add-data form h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .add-data form .sub-field {
            margin-bottom: 15px;
        }

        /* 입력창과 버튼을 나란히 배치 */
        .add-data form .sub-field .input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .add-data form .sub-field .input-group input {
            flex: 1;
        }

        .add-data form .sub-field .input-group button.submit-btn {
            flex: none;
            padding: 12px 20px;
            background-color: var(--info-color);
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            height: 42px;
        }

        .add-data form .sub-field .input-group button.submit-btn:hover {
            background-color: #FFA726;
        }

        /* 추가 버튼을 입력창 아래로 이동 */
        .add-data form .sub-field.add-button {
            text-align: right;
        }

        .add-data form .sub-field.add-button button.submit-btn {
            width: 100%;
            max-width: 200px;
            margin: 0 auto;
        }

        /* 반응형 디자인 */
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }

            h1 {
                font-size: 1.5em;
                margin-bottom: 20px;
            }

            .converter, .add-data {
                padding: 20px 15px;
                max-width: 100%;
            }

            .result {
                font-size: 1em;
                padding: 12px;
            }

            .add-data button, .add-data form .sub-field .input-group button.submit-btn {
                font-size: 0.95em;
                padding: 10px;
                height: 40px;
            }

            /* 입력창과 버튼을 세로로 쌓기 */
            .add-data form .sub-field .input-group {
                flex-direction: column;
                align-items: stretch;
            }

            .add-data form .sub-field .input-group button.submit-btn {
                width: 100%;
                margin-top: 10px;
            }

            /* 추가 버튼을 입력창 아래로 이동 */
            .add-data form .sub-field.add-button button.submit-btn {
                max-width: 100%;
            }
        }

        /* 데스크탑에서 입력창과 버튼의 비율 조정 */
        @media (min-width: 601px) {
            .add-data form .sub-field .input-group input {
                flex: 3;
            }

            .add-data form .sub-field .input-group button.submit-btn {
                flex: 1;
            }
        }

        /* 데이터 관리 페이지 링크 스타일 */
        .manage-link {
            text-align: center;
            margin-top: 30px;
        }

        .manage-link a {
            text-decoration: none;
            color: var(--accent-color);
            font-weight: 500;
            font-size: 0.8em;
            transition: color 0.3s;
        }

        .manage-link a:hover {
            color: var(--primary-color);
        }
    </style>
</head>
<body>

    <h1>그라인더 분쇄도 변환기</h1>

    <!-- 변환기 섹션 -->
    <div class="converter">
        <div class="field">
            <label for="grinderType">그라인더 종류 선택:</label>
            <select id="grinderType">
                <!-- 옵션은 JavaScript에서 동적으로 추가 -->
            </select>
        </div>
        <div class="field">
            <label for="beanCharacteristic">원두 특징 선택:</label>
            <select id="beanCharacteristic">
                <!-- 옵션은 JavaScript에서 동적으로 추가 -->
            </select>
        </div>
        <div class="field">
            <label for="clicks">클릭 수 입력:</label>
            <input type="number" id="clicks" placeholder="클릭 수 입력" step="1">
        </div>
        <div class="field">
            <label for="grind">분쇄도 입력 (µm):</label>
            <input type="number" id="grind" placeholder="분쇄도 입력" step="1">
        </div>
        <div class="result" id="result">
            결과가 여기에 표시됩니다.
        </div>
    </div>

    <!-- 데이터 추가 섹션 -->
    <div class="add-data">
        <button id="toggleAddData">데이터 추가하기</button>

        <!-- 그라인더 종류 추가 폼 -->
        <form id="addGrinderForm">
            <h3>그라인더 종류 추가</h3>
            <div class="sub-field">
                <label for="newGrinder">새 그라인더 이름:</label>
                <div class="input-group">
                    <input type="text" id="newGrinder" placeholder="그라인더 이름 입력">
                    <button type="button" class="submit-btn" onclick="addGrinder()">추가</button>
                </div>
            </div>
        </form>

        <!-- 원두 특징 추가 폼 -->
        <form id="addBeanCharacteristicForm">
            <h3>원두 특징 추가</h3>
            <div class="sub-field">
                <label for="newBeanCharacteristic">새 원두 특징 이름:</label>
                <div class="input-group">
                    <input type="text" id="newBeanCharacteristic" placeholder="원두 특징 이름 입력">
                    <button type="button" class="submit-btn" onclick="addBeanCharacteristic()">추가</button>
                </div>
            </div>
        </form>

        <!-- 그라인더 및 원두 특징 데이터 추가 폼 -->
        <form id="addDataForm">
            <h3>그라인더 & 원두 특징 데이터 추가</h3>
            <div class="sub-field">
                <label for="selectGrinder">그라인더 선택:</label>
                <select id="selectGrinder">
                    <!-- 옵션은 JavaScript에서 동적으로 추가 -->
                </select>
            </div>
            <div class="sub-field">
                <label for="selectBeanCharacteristic">원두 특징 선택:</label>
                <select id="selectBeanCharacteristic">
                    <!-- 옵션은 JavaScript에서 동적으로 추가 -->
                </select>
            </div>
            <div class="sub-field">
                <label for="newClicks">클릭 수:</label>
                <input type="number" id="newClicks" placeholder="클릭 수 입력" step="1">
            </div>
            <div class="sub-field">
                <label for="newGrind">분쇄도 (µm):</label>
                <input type="number" id="newGrind" placeholder="분쇄도 입력" step="1">
            </div>
            <div class="sub-field add-button">
                <button type="button" class="submit-btn" onclick="addData()">추가</button>
            </div>
        </form>
    </div>
    
    <!-- 데이터 관리 페이지로 이동하는 링크 -->
        <div class="manage-link">
            <a href="data_manage.html">데이터 관리</a>
        </div>

    <script>
        const defaultData = {
  "1Zpresso K-Ultra": {
    "약배전 에티오피아 내추럴": [
      {
        "clicks": 100,
        "grind": 1220
      },
      {
        "clicks": 95,
        "grind": 1150
      },
      {
        "clicks": 90,
        "grind": 1080
      },
      {
        "clicks": 85,
        "grind": 1040
      },
      {
        "clicks": 80,
        "grind": 980
      },
      {
        "clicks": 75,
        "grind": 940
      },
      {
        "clicks": 70,
        "grind": 900
      },
      {
        "clicks": 65,
        "grind": 875
      },
      {
        "clicks": 60,
        "grind": 850
      },
      {
        "clicks": 55,
        "grind": 800
      },
      {
        "clicks": 50,
        "grind": 750
      },
      {
        "clicks": 45,
        "grind": 700
      },
      {
        "clicks": 40,
        "grind": 650
      }
    ]
  },
  "KINGrinder K6": {
    "약배전 에티오피아 내추럴": [
      {
        "clicks": 130,
        "grind": 1300
      },
      {
        "clicks": 120,
        "grind": 1200
      },
      {
        "clicks": 110,
        "grind": 1100
      },
      {
        "clicks": 100,
        "grind": 1000
      },
      {
        "clicks": 90,
        "grind": 950
      },
      {
        "clicks": 80,
        "grind": 900
      },
      {
        "clicks": 70,
        "grind": 850
      },
      {
        "clicks": 60,
        "grind": 750
      },
      {
        "clicks": 50,
        "grind": 650
      }
    ]
  },
  "1Zpresso ZP6": {
    "약배전 에티오피아 내추럴": [
      {
        "clicks": 66,
        "grind": 1163
      },
      {
        "clicks": 61,
        "grind": 1100
      },
      {
        "clicks": 56,
        "grind": 1037
      },
      {
        "clicks": 51,
        "grind": 985
      },
      {
        "clicks": 46,
        "grind": 900
      },
      {
        "clicks": 41,
        "grind": 850
      },
      {
        "clicks": 36,
        "grind": 775
      },
      {
        "clicks": 31,
        "grind": 700
      },
      {
        "clicks": 26,
        "grind": 650
      },
      {
        "clicks": 21,
        "grind": 600
      },
      {
        "clicks": 16,
        "grind": 524
      }
    ]
  }
};

        // 데이터 로드 또는 초기화
        let grinderData = JSON.parse(localStorage.getItem('grinderData')) || defaultData;

        // DOM 요소 참조
        const grinderTypeSelect = document.getElementById('grinderType');
        const beanCharacteristicSelect = document.getElementById('beanCharacteristic');
        const selectGrinder = document.getElementById('selectGrinder');
        const selectBeanCharacteristic = document.getElementById('selectBeanCharacteristic');
        const toggleAddDataBtn = document.getElementById('toggleAddData');
        const addGrinderForm = document.getElementById('addGrinderForm');
        const addBeanCharacteristicForm = document.getElementById('addBeanCharacteristicForm');
        const addDataForm = document.getElementById('addDataForm');
        const resultDiv = document.getElementById('result');

        // 초기화 함수
        function initialize() {
            populateGrinderTypes();
            populateBeanCharacteristics();
            populateSelectGrinder();
            populateSelectBeanCharacteristic();
            updateResultMessage("그라인더와 원두 특징을 선택하고 \n 값을 입력하세요.");
        }

        // 그라인더 종류 드롭다운 채우기
        function populateGrinderTypes() {
            grinderTypeSelect.innerHTML = '';
            for (let grinder in grinderData) {
                const option = document.createElement('option');
                option.value = grinder;
                option.textContent = grinder;
                grinderTypeSelect.appendChild(option);
            }
        }

        // 원두 특징 드롭다운 채우기
        function populateBeanCharacteristics() {
            const selectedGrinder = grinderTypeSelect.value;
            beanCharacteristicSelect.innerHTML = '';
            if (selectedGrinder && grinderData[selectedGrinder]) {
                for (let characteristic in grinderData[selectedGrinder]) {
                    const option = document.createElement('option');
                    option.value = characteristic;
                    option.textContent = characteristic;
                    beanCharacteristicSelect.appendChild(option);
                }
            }
        }

        // 데이터 추가 섹션의 그라인더 선택 드롭다운 채우기
        function populateSelectGrinder() {
            selectGrinder.innerHTML = '';
            for (let grinder in grinderData) {
                const option = document.createElement('option');
                option.value = grinder;
                option.textContent = grinder;
                selectGrinder.appendChild(option);
            }
        }

        // 데이터 추가 섹션의 원두 특징 선택 드롭다운 채우기
        function populateSelectBeanCharacteristic() {
            selectBeanCharacteristic.innerHTML = '';
            const selectedGrinder = selectGrinder.value;
            if (selectedGrinder && grinderData[selectedGrinder]) {
                for (let characteristic in grinderData[selectedGrinder]) {
                    const option = document.createElement('option');
                    option.value = characteristic;
                    option.textContent = characteristic;
                    selectBeanCharacteristic.appendChild(option);
                }
            }
        }

        // 그라인더 선택 시 원두 특징 업데이트
        grinderTypeSelect.addEventListener('change', () => {
            populateBeanCharacteristics();
            clearInputs();
            updateResultMessage("그라인더와 원두 특징을 선택하고\n값을 입력하세요.");
        });

        // 데이터 추가 섹션의 그라인더 선택 시 원두 특징 업데이트
        selectGrinder.addEventListener('change', () => {
            populateSelectBeanCharacteristic();
            renderDataList(); // 데이터 목록이 있다면 업데이트
        });

        // 원두 특징 선택 시 입력 필드 초기화
        beanCharacteristicSelect.addEventListener('change', () => {
            clearInputs();
            updateResultMessage("클릭 수 또는 분쇄도를 입력하세요.");
            renderDataList(); // 데이터 목록이 있다면 업데이트
        });

        // 입력 필드 동기화 플래그
        let isUpdating = false;

        // 클릭 수로 분쇄도 찾기 (정수 처리)
        function findGrindFromClicks(inputClicks, data) {
            for (let i = 0; i < data.length - 1; i++) {
                if (inputClicks === data[i].clicks) {
                    return data[i].grind;
                }
                if (inputClicks > data[i].clicks) {
                    return "클릭 수가 너무 높습니다.";
                }
                if (inputClicks < data[i].clicks && inputClicks > data[i+1].clicks) {
                    const ratio = (inputClicks - data[i+1].clicks) / (data[i].clicks - data[i+1].clicks);
                    const grind = data[i+1].grind + ratio * (data[i].grind - data[i+1].grind);
                    return grind.toFixed(1) + " µm";
                }
            }
            if (inputClicks < data[data.length -1].clicks) {
                return "클릭 수가 너무 낮습니다.";
            }
            return "알 수 없는 입력입니다.";
        }

        // 분쇄도로 클릭 수 찾기 (정수 처리)
        function findClicksFromGrind(inputGrind, data) {
            for (let i = 0; i < data.length -1; i++) {
                if (inputGrind === data[i].grind) {
                    return data[i].clicks;
                }
                if (inputGrind < data[i].grind && inputGrind > data[i+1].grind) {
                    const ratio = (inputGrind - data[i+1].grind) / (data[i].grind - data[i+1].grind);
                    const clicks = data[i+1].clicks + ratio * (data[i].clicks - data[i+1].clicks);
                    return clicks.toFixed(0) + " 클릭";
                }
            }
            if (inputGrind > data[0].grind) {
                return "분쇄도가 너무 큽니다.";
            }
            if (inputGrind < data[data.length -1].grind) {
                return "분쇄도가 너무 작습니다.";
            }
            return "알 수 없는 입력입니다.";
        }

        // 결과 메시지 업데이트
        function updateResultMessage(message) {
            resultDiv.innerText = message;
        }

        // 입력 필드 초기화
        function clearInputs() {
            document.getElementById('clicks').value = '';
            document.getElementById('grind').value = '';
        }

        // 클릭 수 입력 시 변환 (정수 처리)
        document.getElementById('clicks').addEventListener('input', () => {
            if (isUpdating) return;
            isUpdating = true;
            const clicksInput = document.getElementById('clicks').value;
            const clicks = parseInt(clicksInput, 10);
            const selectedGrinder = grinderTypeSelect.value;
            const selectedCharacteristic = beanCharacteristicSelect.value;

            if (selectedGrinder && selectedCharacteristic && grinderData[selectedGrinder][selectedCharacteristic]) {
                const data = grinderData[selectedGrinder][selectedCharacteristic];
                if (!isNaN(clicks)) {
                    const grind = findGrindFromClicks(clicks, data);
                    updateResultMessage(`분쇄도: ${grind}`);
                    // 분쇄도 필드 업데이트
                    if (!isNaN(parseFloat(grind))) {
                        const grindValue = parseFloat(grind);
                        document.getElementById('grind').value = grindValue;
                    } else {
                        document.getElementById('grind').value = '';
                    }
                } else {
                    updateResultMessage("유효한 클릭 수를 입력해주세요.");
                    document.getElementById('grind').value = '';
                }
            } else {
                updateResultMessage("그라인더와 원두 특징을 선택해주세요.");
            }
            isUpdating = false;
        });

        // 분쇄도 입력 시 변환 (정수 처리)
        document.getElementById('grind').addEventListener('input', () => {
            if (isUpdating) return;
            isUpdating = true;
            const grindInput = document.getElementById('grind').value;
            const grind = parseInt(grindInput, 10);
            const selectedGrinder = grinderTypeSelect.value;
            const selectedCharacteristic = beanCharacteristicSelect.value;

            if (selectedGrinder && selectedCharacteristic && grinderData[selectedGrinder][selectedCharacteristic]) {
                const data = grinderData[selectedGrinder][selectedCharacteristic];
                if (!isNaN(grind)) {
                    const clicks = findClicksFromGrind(grind, data);
                    updateResultMessage(`클릭 수: ${clicks}`);
                    // 클릭 수 필드 업데이트
                    if (!isNaN(parseFloat(clicks))) {
                        const clicksValue = parseFloat(clicks);
                        document.getElementById('clicks').value = clicksValue;
                    } else {
                        document.getElementById('clicks').value = '';
                    }
                } else {
                    updateResultMessage("유효한 분쇄도를 입력해주세요.");
                    document.getElementById('clicks').value = '';
                }
            } else {
                updateResultMessage("그라인더와 원두 특징을 선택해주세요.");
            }
            isUpdating = false;
        });

        // 데이터 추가 섹션 토글
        toggleAddDataBtn.addEventListener('click', () => {
            addGrinderForm.classList.toggle('active');
            addBeanCharacteristicForm.classList.toggle('active');
            addDataForm.classList.toggle('active');
            toggleAddDataBtn.textContent = toggleAddDataBtn.textContent === "데이터 추가하기" ? "데이터 숨기기" : "데이터 추가하기";
        });

        // 그라인더 추가 함수
        function addGrinder() {
            const newGrinder = document.getElementById('newGrinder').value.trim();
            if (newGrinder === '') {
                alert("그라인더 이름을 입력해주세요.");
                return;
            }
            if (grinderData.hasOwnProperty(newGrinder)) {
                alert("이미 존재하는 그라인더 이름입니다.");
                return;
            }
            grinderData[newGrinder] = {};
            saveData();
            populateGrinderTypes();
            populateSelectGrinder();
            populateBeanCharacteristics();
            populateSelectBeanCharacteristic();
            document.getElementById('newGrinder').value = '';
            alert("그라인더가 성공적으로 추가되었습니다.");
            renderDataList(); // 데이터 목록이 있다면 업데이트
        }

        // 원두 특징 추가 함수
        function addBeanCharacteristic() {
            const newCharacteristic = document.getElementById('newBeanCharacteristic').value.trim();
            const selectedGrinder = selectGrinder.value;
            if (newCharacteristic === '') {
                alert("원두 특징 이름을 입력해주세요.");
                return;
            }
            if (selectedGrinder === '') {
                alert("원두 특징을 추가할 그라인더를 선택해주세요.");
                return;
            }
            if (grinderData[selectedGrinder].hasOwnProperty(newCharacteristic)) {
                alert("이미 존재하는 원두 특징 이름입니다.");
                return;
            }
            grinderData[selectedGrinder][newCharacteristic] = [];
            saveData();
            populateBeanCharacteristics();
            populateSelectBeanCharacteristic();
            document.getElementById('newBeanCharacteristic').value = '';
            alert("원두 특징이 성공적으로 추가되었습니다.");
            renderDataList(); // 데이터 목록이 있다면 업데이트
        }

        // 데이터 추가 함수
        function addData() {
            const selectedGrinder = document.getElementById('selectGrinder').value;
            const selectedCharacteristic = document.getElementById('selectBeanCharacteristic').value;
            const newClicks = parseInt(document.getElementById('newClicks').value, 10);
            const newGrind = parseInt(document.getElementById('newGrind').value, 10);

            if (!selectedGrinder || !selectedCharacteristic) {
                alert("그라인더와 원두 특징을 선택해주세요.");
                return;
            }
            if (isNaN(newClicks) || isNaN(newGrind)) {
                alert("유효한 클릭 수와 분쇄도를 입력해주세요.");
                return;
            }

            // 중복 클릭 수 또는 분쇄도 확인
            const existingData = grinderData[selectedGrinder][selectedCharacteristic];
            for (let entry of existingData) {
                if (entry.clicks === newClicks || entry.grind === newGrind) {
                    alert("이미 동일한 클릭 수 또는 분쇄도가 존재합니다.");
                    return;
                }
            }

            grinderData[selectedGrinder][selectedCharacteristic].push({ clicks: newClicks, grind: newGrind });
            // 정렬 (클릭 수 내림차순)
            grinderData[selectedGrinder][selectedCharacteristic].sort((a, b) => b.clicks - a.clicks);
            saveData();
            document.getElementById('newClicks').value = '';
            document.getElementById('newGrind').value = '';
            alert("데이터가 성공적으로 추가되었습니다.");
            renderDataList(); // 데이터 목록이 있다면 업데이트
        }

        // 데이터 삭제 함수 (메인 페이지에서도 데이터 목록을 렌더링하려면 추가 필요)
        function deleteData(grinder, characteristic, index) {
            if (confirm("해당 데이터를 정말 삭제하시겠습니까?")) {
                grinderData[grinder][characteristic].splice(index, 1);
                saveData();
                alert("데이터가 성공적으로 삭제되었습니다.");
                renderDataList(); // 데이터 목록이 있다면 업데이트
            }
        }

        // 데이터 저장 함수
        function saveData() {
            localStorage.setItem('grinderData', JSON.stringify(grinderData));
        }

        // 데이터 목록 렌더링 함수 (메인 페이지에서는 별도의 데이터 목록이 없으므로 필요 없을 수도 있음)
        function renderDataList() {
            // 현재 메인 페이지에는 데이터 목록이 없으므로 이 함수는 필요 없습니다.
            // 데이터 관리 페이지에서 별도로 구현됩니다.
        }

        // 초기화 실행
        initialize();
    </script>

</body>
</html>
